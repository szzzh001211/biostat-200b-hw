---
title: "Biostat 200B Project"
subtitle: Group 1
format:
  html:
    theme: cosmo
    embed-resources: true
    number-sections: false
    toc: true
    toc-depth: 4
    toc-location: left
    code-fold: false
knitr:
  opts_chunk: 
    cache: false    
    echo: true
    fig.align: 'center'
    fig.width: 6
    fig.height: 4
    message: FALSE
execute:
  eval: true    
---

## Data Preprocessing

```{r}
library(haven)
library(tidyverse)
library(gtsummary)
library(knitr)
library(kableExtra)
library(broom)

data <- read_sas('./rise.sas7bdat') |>
  select(-c(ID, PSS_BL, ISI_SCORE_BL, PSQI_BL, SF36V1_PCS_BL, 
            SF36V1_MCS_BL, FSI_SEVERITY_BL, RACE4, HISPANIC,
            MFSI_TOT_BL, MAAS_BL, MENOSTATFINAL_BL, AGE_DX)) |>
  mutate(EMPLOY3 = ifelse(EMPLOY3 == "3 Not employed",
                       "0 Not employed", "1 Employed"),
         STAGEDX_PG = ifelse(STAGEDX_PG == 3 | STAGEDX_PG == 8, 
                             "3 or higher", STAGEDX_PG),
         SURGTYPE_ENROLLMENT_BINARY = ifelse(SURGTYPE_ENROLLMENT_BINARY == "",
                                             "no surgery",
                                             SURGTYPE_ENROLLMENT_BINARY),
         INCOME3 = ifelse(INCOME3 == "", NA, INCOME3)) |>
  mutate(MARRIED2 = as.factor(MARRIED2),
         EDUC3 = as.factor(EDUC3),
         EMPLOY3 = as.factor(EMPLOY3),
         INCOME3 = as.factor(INCOME3),
         CTQ_WALKER_CAT_BL = as.factor(CTQ_WALKER_CAT_BL),
         STAGEDX_PG = as.factor(STAGEDX_PG),
         SURGTYPE_ENROLLMENT_BINARY = as.factor(SURGTYPE_ENROLLMENT_BINARY),
         SCID_PHMDD = as.factor(SCID_PHMDD),
         RACE5 = as.factor(RACE5),
         GODIN2 = as.factor(GODIN2)) |>
  as_tibble()

# check the distribution of the continuous variable
hist(data$CESD_BL)
hist(data$AGE_BL)
hist(data$ALC_DRINKS_PAST_YEAR)
hist(data$BMI_BL)
hist(data$CHARLSON)

# make transformation to the continuous variable
hist(log(data$CESD_BL+1))
hist(log(data$BMI_BL))


processed_data <- data |>
  mutate(CESD_BL = log(CESD_BL + 1),
         BMI_BL = log(BMI_BL),
         ALC_CLASS = case_when(
           ALC_DRINKS_PAST_YEAR == 0 ~ "No Drink",
           ALC_DRINKS_PAST_YEAR > 0 & ALC_DRINKS_PAST_YEAR < 100 ~ 
             "Moderate Drink",
           ALC_DRINKS_PAST_YEAR >= 100 ~ "Heavy Drink")) |> 
  mutate(ALC_CLASS = as.factor(ALC_CLASS)) |> 
  select(-ALC_DRINKS_PAST_YEAR) |>
  na.omit()

tbl_summary(processed_data)

```


## Model Fitting
```{r}

variables <- names(processed_data)
variables <- variables[variables != "CESD_BL"]

# univariate regression
regression_results <- lapply(variables, function(var) 
  lm(CESD_BL ~ ., data = processed_data[, c("CESD_BL", var)]))


summary_results <- lapply(regression_results, summary)

p_values <- lapply(summary_results, function(summary_result) {
  f_statistic <- summary_result$fstatistic
  p_value <- pf(f_statistic[1], f_statistic[2], f_statistic[3], 
                lower.tail = FALSE)
  return(p_value)
}) |> unlist()

# selected results
detailed_label<-c("Leisure-time exercise", "Age", "Partnered status", 
                  "Education", "Employment", "Annual income", 
                  "Childhood maltreatment", "Charlson comorbidity", 
                  "Cancer stage at diagnosis", 
                  "Breast cancer surgery type before enrollment in study", 
                  "Past history of depression", "BMI", "Race", 
                  "Alcohol use level")
p_values_tibble <- tibble(
  Variable = variables,
  Index = detailed_label,
  P_Value = format(p_values, scientific = FALSE, digits = 5)
) |> 
  mutate(Selected = ifelse(P_Value < 0.1, "Y", "N"))

p_values_tibble |>
  kable("html") |>
  kable_styling(full_width = F)


fit <- lm(CESD_BL ~ AGE_BL + INCOME3 + CTQ_WALKER_CAT_BL + CHARLSON + 
            SURGTYPE_ENROLLMENT_BINARY + SCID_PHMDD + RACE5, 
          data = processed_data)

rsquared <- summary(fit)$r.squared
tidy_results <- tidy(fit)

tidy_results$rsquared <- rsquared

tidy_results |> 
  kable("html") |>
  kable_styling(full_width = F)

```
##Introduction: 
Fatigue, as quantified by the Center for Epidemiological Studies Depression Scale, is one of the most common and neglected side effects of cancer and its treatment. It will lead to negative consequences for patients and their families, and may even affect treatment compliance and efficacy (1: original ariticle).\
The Center for Epidemiological Studies Depression Scale (CES-D) is recognized as a relatively common measure for assessing depressive symptom in women during cancer treatment (2); however, there have been only a few studies examining factors associated with fatigue before treatement (2: Measurement of depressive symptoms in cancer patients: Evaluation of the center for epidemiological studies depression scale).\
CESD_BL may be associated with biobehavioral factors which can contribute to identifying patients who are susceptible or at risk, thus enabling them to receive assistance through targeted intervention before adjuvant treatment.

##Objective:
Assess the relationship between CESD_BL (Center for Epidemiological Studies Depression Scale) and biobehavioral risk variables in women with early-stage breast cancer before they receive adjuvant therapy.\
Identify which variables explain changes in CESD_BL in this population and which are interesting for further study and targeted intervention.




